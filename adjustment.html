<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>How to adjust – Interactive DAGs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-a67ac2868200dddf7a4f0e3ae403775c.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-82d683e9f830cba069e3fb8cbfbea53b.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-a67ac2868200dddf7a4f0e3ae403775c.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7f02591ba1238031d98d2afc9f6cbd7b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-8a5a79524d0361beb92d79fa9e3dc012.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-7f02591ba1238031d98d2afc9f6cbd7b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Interactive DAGs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./confounders.html"> 
<span class="menu-text">Confounders</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mediators.html"> 
<span class="menu-text">Mediators</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./colliders.html"> 
<span class="menu-text">Colliders</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./do-calculus.html"> 
<span class="menu-text"><em>do</em>-calculus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./adjustment.html" aria-current="page"> 
<span class="menu-text">How to adjust</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-adjust" id="toc-how-to-adjust" class="nav-link active" data-scroll-target="#how-to-adjust">How to adjust</a></li>
  <li><a href="#backdoor-adjustment" id="toc-backdoor-adjustment" class="nav-link" data-scroll-target="#backdoor-adjustment">Backdoor adjustment</a>
  <ul class="collapse">
  <li><a href="#simulated-data-and-naive-estimate" id="toc-simulated-data-and-naive-estimate" class="nav-link" data-scroll-target="#simulated-data-and-naive-estimate">Simulated data and naive estimate</a></li>
  <li><a href="#how-do-we-isolate-what-were-looking-for" id="toc-how-do-we-isolate-what-were-looking-for" class="nav-link" data-scroll-target="#how-do-we-isolate-what-were-looking-for">How do we isolate what we’re looking for?</a></li>
  <li><a href="#how-to-actually-close-backdoors" id="toc-how-to-actually-close-backdoors" class="nav-link" data-scroll-target="#how-to-actually-close-backdoors">How to actually close backdoors</a></li>
  </ul></li>
  <li><a href="#front-door-adjustment" id="toc-front-door-adjustment" class="nav-link" data-scroll-target="#front-door-adjustment">Front-door adjustment</a>
  <ul class="collapse">
  <li><a href="#simulated-data-and-naive-estimate-1" id="toc-simulated-data-and-naive-estimate-1" class="nav-link" data-scroll-target="#simulated-data-and-naive-estimate-1">Simulated data and naive estimate</a></li>
  <li><a href="#how-do-we-isolate-what-were-looking-for-1" id="toc-how-do-we-isolate-what-were-looking-for-1" class="nav-link" data-scroll-target="#how-do-we-isolate-what-were-looking-for-1">How do we isolate what we’re looking for?</a></li>
  <li><a href="#how-to-actually-do-front-door-adjustment" id="toc-how-to-actually-do-front-door-adjustment" class="nav-link" data-scroll-target="#how-to-actually-do-front-door-adjustment">How to actually do front-door adjustment</a></li>
  <li><a href="#hic-sunt-dracones" id="toc-hic-sunt-dracones" class="nav-link" data-scroll-target="#hic-sunt-dracones">Hic sunt dracones</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How to adjust</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="how-to-adjust" class="level1 column-screen hero-banner-mini">
<h1>How to adjust</h1>
<p><i class="fa-solid fa-door-open" aria-label="door-open"></i></p>
</section>
<div class="general-note fs-5">
<p>In general “conditioning on” a variable means somehow considering it in the estimate of the relationship between X and Y.</p>
</div>
<p>Conditioning can be explicit, like including a variable in a model. This is often called “adjusting.”</p>
<p>Conditioning can also be implicit, like collecting data only about one part of the population, which sneakily builds it into the data and can create <a href="./colliders.html">collider bias</a>.</p>
<section id="backdoor-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="backdoor-adjustment">Backdoor adjustment</h2>
<p>Backdoor adjusting involves removing the effect of confounders to estimate the average causal effect of a treatment <span class="math inline">X</span> on an outcome <span class="math inline">Y</span>.</p>
<p>There are lots of different methods to adjust for variables. Instead of working with abstract Xs, Ys, and Zs, we’ll make things more concrete with a more realistic example of the effect of mosquito nets on household health status:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<ul>
<li><span class="math inline">X</span> = mosquito net use (binary: 0 = no net, 1 = uses net)</li>
<li><span class="math inline">Y</span> = health status (continuous score, roughly 0–100)</li>
<li><span class="math inline">Z</span> = household income (binary: 0 = low, 1 = high)</li>
</ul>
<p>Income confounds the relationship between nets and health: wealthier households are more likely to use nets <em>and</em> tend to be healthier for other reasons.</p>
<details class="code-fold">
<summary>Show code for tikz-based DAG</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode tex code-with-copy"><code class="sourceCode latex"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}[&gt;={stealth}]</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (x) at (0,0) {X};</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (y) at (2,0) {Y};</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (z) at (1,1) {Z};</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;] (z) edge (x);</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;] (z) edge (y);</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;] (x) edge (y);</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details class="code-fold">
<summary>Show code for {ggdag}-based DAG</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>mosquito_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> Z,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> Z,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">Z =</span> <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">Z =</span> <span class="dv">2</span>)),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="st">"Mosquito net"</span>, <span class="at">Y =</span> <span class="st">"Health status"</span>, <span class="at">Z =</span> <span class="st">"Household income"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>mosquito_dag_plot <span class="ot">&lt;-</span> mosquito_dag <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_status</span>()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mosquito_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_label</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(mosquito_dag_plot, <span class="sc">!</span><span class="fu">is.na</span>(status)),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.35</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_label</span>(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(mosquito_dag_plot, <span class="fu">is.na</span>(status)),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.35</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#9b332b"</span>, <span class="st">"#262d42"</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"#d39a2d"</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">3.3</span>)) <span class="sc">+</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-both-dags" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-both-dags-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-extra.preamble="[&quot;\usepackage{libertine}&quot;,&quot;\usepackage{libertinust1math}&quot;,&quot;\usepackage{positioning}&quot;]" data-ref-parent="fig-both-dags" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-both-dags">
<div id="fig-dag-tikz" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="95%">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-dag-tikz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="adjustment_files/figure-html/fig-dag-tikz-1.svg" id="fig-dag-tikz" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:95.0%" data-ref-parent="fig-both-dags">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-dag-tikz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-both-dags" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-both-dags">
<div id="fig-dag-ggdag" class="quarto-float quarto-figure quarto-figure-center anchored" width="384">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-dag-ggdag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="adjustment_files/figure-html/fig-dag-ggdag-1.png" id="fig-dag-ggdag" class="img-fluid figure-img" data-ref-parent="fig-both-dags" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-dag-ggdag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-both-dags-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Basic DAG showing that household income (<span class="math inline">Z</span>) confounds the relationship between mosquito net use (<span class="math inline">X</span>) and health status (<span class="math inline">Y</span>)
</figcaption>
</figure>
</div>
<section id="simulated-data-and-naive-estimate" class="level3">
<h3 class="anchored" data-anchor-id="simulated-data-and-naive-estimate">Simulated data and naive estimate</h3>
<p>To illustrate all these different adjustment techniques, we’ll simulate some data where the true causal effect of net use on health is 10 points.</p>
<p>People have a 50% chance of having high or low income. Net use depends on income, and wealthier households are more likely to use nets. Health depends on both net use and income, plus some random noise.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">114941</span>, {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  net_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> z)),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">50</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">15</span> <span class="sc">*</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x, y, z)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If we just look at the relationship of <span class="math inline">X</span> on <span class="math inline">Y</span> without adjusting for anything, we will not get the correct effect for <span class="math inline">X</span> because of confounding. The coefficient on <code>x</code> here is bigger than the true effect of 10 because it conflates the causal effect of nets with the income advantage that net users tend to have.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model_naive <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> net_data)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_naive, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       53.77 | 0.36 | [53.07, 54.47] | 151.29 | &lt; .001
x           |       17.32 | 0.51 | [16.32, 18.32] |  34.05 | &lt; .001</code></pre>
</div>
</div>
</section>
<section id="how-do-we-isolate-what-were-looking-for" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-isolate-what-were-looking-for">How do we isolate what we’re looking for?</h3>
<p>The main estimand we care about here is the causal effect of mosquito nets on health status, or what would happen if we intervened on <span class="math inline">X</span> and set <span class="math inline">X = x</span> (or gave people nets).</p>
<p>Using <em>do</em>-calculus notation, we’ll work with this interventional distribution:</p>
<p><span class="math display">
\begin{aligned}
&amp;P(y \mid \operatorname{do}(x)), \text{ or} \\[6pt]
&amp;P(\text{Health} \mid \operatorname{do}(\text{Net}))
\end{aligned}
</span></p>
<p>The specific quantity we’ll estimate is a comparison or contrast within this distribution—we want to know the difference in the average value of <span class="math inline">Y</span> when we intervene and when we don’t intervene with nets, or:</p>
<p><span class="math display">
\begin{aligned}
&amp;E[Y \mid \operatorname{do}(x = 1)] - E[Y \mid \operatorname{do}(x = 0)], \text{ or} \\[6pt]
&amp;E[\text{Health} \mid \operatorname{do}(\text{net} = 1)] - E[\text{Health} \mid \operatorname{do}(\text{net} = 0)]
\end{aligned}
</span></p>
<p>The <a href="./do-calculus.html#eq-backdoor">backdoor adjustment formula</a> tells us what we need to do to estimate <span class="math inline">P(y \mid \operatorname{do}(x))</span>:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)
</span></p>
<p>In words, this means we need to estimate the distribution of <span class="math inline">Y</span> given <span class="math inline">X</span> and <span class="math inline">Z</span> (<span class="math inline">P(y \mid x, z)</span>) weighted by the marginal probability of each level of <span class="math inline">Z</span> (<span class="math inline">P(z)</span>).</p>
</section>
<section id="how-to-actually-close-backdoors" class="level3">
<h3 class="anchored" data-anchor-id="how-to-actually-close-backdoors">How to actually close backdoors</h3>
<p>There are many ways to implement backdoor adjustment, like these common approaches:</p>
<ul>
<li>Stratification</li>
<li>Regression adjustment</li>
<li>Matching</li>
<li>Inverse probability weighting</li>
<li>G-computation</li>
</ul>
<p>I’ll show a short example of each of these below, and I’ll include some extra resources and information about them in each section. There are are different variations and flavors of these different approaches, and there are methods I don’t include here<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>—this is definitely not comprehensive!</p>
<section id="stratification" class="level4">
<h4 class="anchored" data-anchor-id="stratification">Stratification</h4>
<p>The most direct translation of the backdoor formula is to hold <span class="math inline">Z</span> constant by stratifying, or finding the effect of net use within each income group and calculating the weighted average across groups.</p>
<p>We can do this with <code>group_by()</code> and <code>summarize()</code> from {dplyr}:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>group_effects <span class="ot">&lt;-</span> net_data <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(z) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">mean</span>(y[x <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(y[x <span class="sc">==</span> <span class="dv">0</span>]),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>group_effects</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
      z effect     n
  &lt;int&gt;  &lt;dbl&gt; &lt;int&gt;
1     0   10.1   506
2     1   10.3   494</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(group_effects<span class="sc">$</span>effect, group_effects<span class="sc">$</span>n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.18125</code></pre>
</div>
</div>
<p>Stratification is neat and easy, but only works with discrete confounders that have few levels. If you have a continuous confounder (e.g., actual monthly income instead of a binary yes/no), or a confounder with lots of levels (e.g., country or state), or multiple confounders (e.g.&nbsp;both income and country), you’d have too many groups and too few observations per group.</p>
</section>
<section id="regression-adjustment" class="level4">
<h4 class="anchored" data-anchor-id="regression-adjustment">Regression adjustment</h4>
<p>An alternative to direct stratified weighted averages is to use regression (which is fundamentally just fancy averaging). We can include the confounder as a covariate:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Control for z</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model_controlled <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> net_data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_controlled, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(997) |      p
-------------------------------------------------------------------
(Intercept) |       50.03 | 0.23 | [49.57, 50.49] | 213.78 | &lt; .001
x           |       10.18 | 0.35 | [ 9.49, 10.88] |  28.78 | &lt; .001
z           |       14.63 | 0.35 | [13.94, 15.33] |  41.36 | &lt; .001</code></pre>
</div>
</div>
<p>The coefficient for <code>x</code> is the effect of net use on health, holding income constant. You can include any number of confounders and they can be binary, categorical, or continuous.</p>
<p>Regression adjustment works well when the functional form is correct. In this case, we simulated the data using linear relationships without any interactions or non-linear terms, so the causal effect is correct. But in real life, you’re betting that the functional form of the model captures the true relationship between confounders and outcome.</p>
</section>
<section id="matching" class="level4">
<h4 class="anchored" data-anchor-id="matching">Matching</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Extra resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>TODO</p>
</div>
</div>
<p>Another approach is to modify the <em>sample</em> before fitting an outcome model so that we can compare treated and untreated units without confounding.</p>
<p>We can match each treated unit with a comparable control unit based on their values of the confounder (e.g.&nbsp;create a new sample where net users and non-users are paired within each income group).</p>
<p><a href="https://kosukeimai.github.io/MatchIt/">{MatchIt}</a> makes this straightforward, and it provides a ton of different matching methods and estimands. Here we’ll use exact matching:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Find matched pairs of x based on values of z</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matchit</span>(x <span class="sc">~</span> z, <span class="at">data =</span> net_data, <span class="at">method =</span> <span class="st">"exact"</span>, <span class="at">estimand =</span> <span class="st">"ATE"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the matches as a data frame</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match_data</span>(m)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate y ~ x with the matched data (and use the matched weights)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>model_matched <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> matched_data, <span class="at">weights =</span> weights)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_matched, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       57.24 | 0.39 | [56.47, 58.00] | 147.11 | &lt; .001
x           |       10.18 | 0.56 | [ 9.09, 11.27] |  18.28 | &lt; .001</code></pre>
</div>
</div>
<p>The coefficient for <code>x</code> is the effect of net use on health. Because we estimated this on matched data that has comparable values of the confounder, we’ve adjusted for <span class="math inline">Z</span>.</p>
</section>
<section id="inverse-probability-weighting-ipw" class="level4">
<h4 class="anchored" data-anchor-id="inverse-probability-weighting-ipw">Inverse probability weighting (IPW)</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Extra resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>TODO</p>
</div>
</div>
<p>Matching is neat, but it typically involves discarding unmatched units. An alternative approach is to reweight observations to create balanced groups of treated and untreated units.</p>
<p>The most common way to do this is to create inverse probability weights, where all treated people get a weight of <span class="math inline">\frac{1}{p_i}</span> and all untreated people get a weight of <span class="math inline">\frac{1}{1 - p_i}</span> (where <span class="math inline">p_i</span> refers to each person’s propensity scores). This creates a “pseudo-population” where treatment is independent of the confounders, mimicking what randomization would have achieved.</p>
<p>Practically speaking, this gives more weight to more unusual and unexpected observations. For instance, someone with a high predicted probability (90%) of choosing to use a net who then uses a net isn’t really notable and will have a low weight (<span class="math inline">\frac{1}{0.9}</span>, or 1.111). Someone else with a high probability (90% again) of choosing a net who <em>doesn’t</em> use a net will have a high weight (<span class="math inline">\frac{1}{1 - 0.9}</span>, or 10). This makes it so that the should-have-probably-used-a-net person is more comparable to the corresponding treated people.</p>
<p>We adjust for confounding with inverse probability weights with this process:</p>
<ul>
<li><p><strong>Create a treatment model</strong>: Use the confounders to calculate propensity scores—or the probability of being treated—for each observation, typically using logistic regression (if the treatment is binary) or some other regression model (if the treatment is continuous)</p></li>
<li><p><strong>Calculate inverse probability weights</strong>: Use the propensity scores and observed treatment status to create weights. There are lots of ways to do this! A common formula for binary treatments looks like this:</p>
<p><span class="math display">
\frac{\text{Treatment}}{\text{Propensity}} + \frac{1 - \text{Treatment}}{1 - \text{Propensity}}
</span></p>
<p>The <a href="https://ngreifer.github.io/WeightIt/">{WeightIt}</a> package provides many other weighting methods for binary and continuous treatments.</p></li>
<li><p><strong>Use the weights in an outcome model</strong>: Use the inverse probability weights to reweight all the observations in your sample when running your regression model. A common way to do this is with the <code>weights</code> argument in <code>lm()</code>.</p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Manual IPW</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">IPW with {WeightIt}</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment model with logistic regression</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate probability of x based on values of z</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>model_ipw_treatment <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">~</span> z,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> net_data</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Propensity scores and weights</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>data_ipw <span class="ot">&lt;-</span> net_data <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">predict</span>(model_ipw_treatment, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipw =</span> (x <span class="sc">/</span> prob) <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> prob))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate y ~ x with the newly weighted pseudo-population</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>model_ipw_outcome <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_ipw, <span class="at">weights =</span> ipw)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_ipw_outcome, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       57.24 | 0.39 | [56.47, 58.01] | 145.37 | &lt; .001
x           |       10.18 | 0.56 | [ 9.09, 11.27] |  18.28 | &lt; .001</code></pre>
</div>
</div>
<p><em>Technically</em> the coefficient is correct, but the standard errors do not account for the fact that the weights were estimated, so they will be incorrect.</p>
<p>One way around this is to calculate bootstrapped standard errors; see <a href="https://www.r-causal.org/chapters/02-whole-game#estimate-the-causal-effect">Chapter 2</a> and <a href="https://www.r-causal.org/chapters/11-outcome-model#estimating-uncertainty">Chapter 11</a> in <em>Causal Inference in R</em> <span class="citation" data-cites="todo">[@todo]</span> for more details and complete examples.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment model with logistic regression</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate probability of x based on values of z</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">weightit</span>(x <span class="sc">~</span> z, <span class="at">data =</span> net_data, <span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">estimand =</span> <span class="st">"ATE"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate y ~ x with the newly weighted pseudo-population</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>model_ipw_weightit <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(y <span class="sc">~</span> x, <span class="at">data =</span> net_data, <span class="at">weightit =</span> W)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_ipw_weightit, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       57.24 | 0.34 | [56.57, 57.91] | 167.81 | &lt; .001
x           |       10.18 | 0.35 | [ 9.49, 10.88] |  28.76 | &lt; .001</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Use {WeightIt} weights manually
</div>
</div>
<div class="callout-body-container callout-body">
<p>You don’t <em>have</em> to use <code>lm_weightit()</code> for the outcome model. You can extract the actual weights from <code>W</code> and use them in regular <code>lm()</code>, but then you’re responsible for making sure the standard errors are correctly adjusted, which is tricky. By default, <code>lm_weightit()</code> internally uses something called “M-estimation” to account for the fact that the weights themselves are uncertain. If we use something like <code>vcov = "HC0"</code> in <code>model_parameters()</code>, we’ll get robust standard errors without incorporating the uncertainty in the weights, and they’ll be different:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add propensity scores and weights to data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data_ipw_weightit <span class="ot">&lt;-</span> net_data <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> W<span class="sc">$</span>ps,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipw =</span> W<span class="sc">$</span>weights</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate y ~ x with the newly weighted pseudo-population</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>model_ipw_weightit_manual <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_ipw_weightit, <span class="at">weights =</span> ipw)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  model_ipw_weightit_manual,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcov =</span> <span class="st">"HC0"</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       57.24 | 0.45 | [56.36, 58.11] | 128.25 | &lt; .001
x           |       10.18 | 0.64 | [ 8.93, 11.43] |  15.97 | &lt; .001</code></pre>
</div>
</div>
<p>One way around this is to calculate bootstrapped standard errors; see <a href="https://www.r-causal.org/chapters/11-outcome-model#estimating-uncertainty">Chapter 11</a> in <em>Causal Inference in R</em> <span class="citation" data-cites="todo">[@todo]</span> for more details. You can also calculate bootstrapped standard errors with <code>lm_weightit()</code> if you want with <code>lm_weightit(..., vcov = "BS")</code>.</p>
</div>
</div>
</div>
</div>
</div>
<p>The coefficient for <code>x</code> is the effect of net use on health. Because we estimated this on a reweighted pseudo-population, we’ve adjusted for <span class="math inline">Z</span>.</p>
</section>
<section id="g-computation" class="level4">
<h4 class="anchored" data-anchor-id="g-computation">G-computation</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Extra resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>TODO</p>
</div>
</div>
<p>Matching and inverse probability weighting both let us manipulate the sample to get balanced populations—exactly balanced in the case of matching, reweighted pseudo-populations in the case of IPW. With these approaches, we model the process of being assigned to treatment.</p>
<p>A neat alternative to weighting and sample manipulation is to use something called the parametric G-formula or G-computation. It’s surprisingly straightforward:</p>
<ol type="1">
<li>Fit a model that estimates the outcome, controlling for confounders</li>
<li>Use the model to generate a set of predictions where we pretend that every row was treated (i.e.&nbsp;set <code>x = 1</code>)</li>
<li>Use the model to generate a set of predictions where we pretend that every row was not treated (i.e.&nbsp;set <code>x = 0</code>)</li>
<li>Calculate the difference in the two sets of predictions, then find the average of <em>that</em>. This is the causal effect.</li>
</ol>
<p>This approach feels more like the causal estimand that we originally defined:</p>
<p><span class="math display">
\begin{aligned}
&amp;E[Y \mid \operatorname{do}(x = 1)] - E[Y \mid \operatorname{do}(x = 0)], \text{ or} \\[6pt]
&amp;E[\text{Health} \mid \operatorname{do}(\text{net} = 1)] - E[\text{Health} \mid \operatorname{do}(\text{net} = 0)]
\end{aligned}
</span></p>
<p>In this case, we use code to set everyone’s treatment to <span class="math inline">\operatorname{do}(\text{net} = 1)</span>, then set everyone to <span class="math inline">\operatorname{do}(\text{net} = 0)</span>, and then find the average difference in outcomes.</p>
<p>With G-computation, we can technically use whatever kind of outcome model we want. We can use a simple model like <code>lm(y ~ x + z)</code>, or we can include interactions and splines or use even more flexible machine learning models to reduce the risk of misspecification.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Manual</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">With {marginaleffects}</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">IPW + G-computation</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>This manual approach works well, but doesn’t include standard errors or other details. You can calculate standard errors by bootstrapping—see <a href="https://www.r-causal.org/chapters/13-g-comp">Chapter 13</a> in <em>Causal Inference in R</em> <span class="citation" data-cites="todo">[@todo]</span>—or you use something like {marginaleffects}.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit outcome model with confounders</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>model_gcomp <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> net_data)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict outcomes when everyone is treated and everyone is untreated</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_gcomp, <span class="at">newdata =</span> <span class="fu">mutate</span>(net_data, <span class="at">x =</span> <span class="dv">1</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_gcomp, <span class="at">newdata =</span> <span class="fu">mutate</span>(net_data, <span class="at">x =</span> <span class="dv">0</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find difference in means, or average treatment effect (ATE)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y1) <span class="sc">-</span> <span class="fu">mean</span>(y0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.18308</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>{marginaleffects} can do all the work of setting everyone’s treatment to 0, to 1, and finding the difference automatically. It can also provide robust and/or clustered standard errors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>model_gcomp <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> net_data)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(model_gcomp, <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %
     10.2      0.354 28.8   &lt;0.001 602.5  9.49   10.9

Term: x
Type: response
Comparison: 1 - 0</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>We technically don’t have to use an unweighted outcome model. We can use IPW like normal and then use it for g-computation. The authors of {WeightIt} <a href="https://ngreifer.github.io/WeightIt/articles/estimating-effects.html#g-computation">recommend using weighted g-computation whenever possible</a> to benefit from the idea of pseudo-populations <em>and</em> the flexibility of calculating contrasts.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment model with logistic regression</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate probability of x based on values of z</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>W_gcomp <span class="ot">&lt;-</span> <span class="fu">weightit</span>(x <span class="sc">~</span> z, <span class="at">data =</span> net_data, <span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">estimand =</span> <span class="st">"ATE"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate y ~ x with the newly weighted pseudo-population</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Including x * z allows the effect of x to vary across levels of z</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>model_weighted <span class="ot">&lt;-</span> <span class="fu">lm_weightit</span>(y <span class="sc">~</span> x <span class="sc">*</span> z, <span class="at">data =</span> net_data, <span class="at">weightit =</span> W_gcomp)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># G-computation on the weighted model</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(model_weighted, <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %
     10.2      0.354 28.8   &lt;0.001 601.8  9.49   10.9

Term: x
Type: probs
Comparison: 1 - 0</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="front-door-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="front-door-adjustment">Front-door adjustment</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Extra resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>TODO</p>
</div>
</div>
<p>All the methods above require observing the confounder <span class="math inline">Z</span>. But what if there are unobservable confounders that we can’t measure?!</p>
<p>Let’s change the example a little bit. We’ll get rid of <span class="math inline">Z</span> and add two new nodes:</p>
<ul>
<li><span class="math inline">X</span> = mosquito net use (binary: 0 = no net, 1 = uses net)</li>
<li><span class="math inline">Y</span> = health status (continuous score, roughly 0–100)</li>
<li><span class="math inline">M</span> = average number of mosquitos near the bed at night (continuous)</li>
<li><span class="math inline">U</span> = <em>unobserved</em> general health behaviors</li>
</ul>
<p>Mosquitos (<span class="math inline">M</span>) are the mechanism for how mosquito nets affect health status. When nets are used, the number of mosquitos present in the immediate vicinity of a person should drop significantly. In theory, that count of mosquitos should be completely uninfluenced by anything else and <em>only</em> influenced by mosquito net use. In practice, this probably isn’t the case! Actual front-door mediators are really hard to find in real life. But just go with it.</p>
<p>General health behaviors (<span class="math inline">U</span>) confound the relationship between nets and health, but we can’t measure them; health-conscious people are more likely to use nets <em>and</em> tend to be healthier through other channels.</p>
<details class="code-fold">
<summary>Show code for tikz-based DAG</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode tex code-with-copy"><code class="sourceCode latex"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">\definecolor</span>{ucolor}{HTML}{888888}</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}[&gt;={stealth}]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (x) at (0,0) {X};</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (m) at (2,0) {M};</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (y) at (4,0) {Y};</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span>[ucolor] (u) at (2,1.5) {U};</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;] (x) edge (m);</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;] (m) edge (y);</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;, dashed, ucolor] (u) edge (x);</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span>[-&gt;, dashed, ucolor] (u) edge (y);</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details class="code-fold">
<summary>Show code for {ggdag}-based DAG</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mosquito_dag_frontdoor <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> M <span class="sc">+</span> U,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> U,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> X,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">latent =</span> <span class="st">"U"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">M =</span> <span class="dv">2</span>, <span class="at">U =</span> <span class="dv">2</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">M =</span> <span class="dv">1</span>, <span class="at">U =</span> <span class="dv">2</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="st">"Mosquito net"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="st">"Health status"</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">M =</span> <span class="st">"Mosquitos near bed"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">U =</span> <span class="st">"Health behaviors"</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>mosquito_dag_frontdoor_plot <span class="ot">&lt;-</span> mosquito_dag_frontdoor <span class="sc">|&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_status</span>()</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  mosquito_dag_frontdoor_plot,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span>) <span class="sc">+</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_label</span>(</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>      mosquito_dag_frontdoor_plot,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>      status <span class="sc">!=</span> <span class="st">"latent"</span> <span class="sc">|</span> <span class="fu">is.na</span>(status)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.35</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_label</span>(</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(mosquito_dag_frontdoor_plot, status <span class="sc">==</span> <span class="st">"latent"</span>),</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.35</span>,</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Atkinson Hyperlegible"</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#9b332b"</span>, <span class="st">"grey50"</span>, <span class="st">"#262d42"</span>),</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"#d39a2d"</span>,</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">3.3</span>)) <span class="sc">+</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-both-dags-frontdoor" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-both-dags-frontdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-extra.preamble="[&quot;\usepackage{libertine}&quot;,&quot;\usepackage{libertinust1math}&quot;,&quot;\usepackage{positioning}&quot;]" data-ref-parent="fig-both-dags-frontdoor" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-both-dags-frontdoor">
<div id="fig-frontdoor-dag" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-frontdoor-dag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="adjustment_files/figure-html/fig-frontdoor-dag-1.svg" id="fig-frontdoor-dag" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-both-dags-frontdoor" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-frontdoor-dag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-both-dags-frontdoor" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-both-dags-frontdoor">
<div id="fig-dag-ggdag-frontdoor" class="quarto-float quarto-figure quarto-figure-center anchored" width="384">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-dag-ggdag-frontdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="adjustment_files/figure-html/fig-dag-ggdag-frontdoor-1.png" id="fig-dag-ggdag-frontdoor" class="img-fluid figure-img" data-ref-parent="fig-both-dags-frontdoor" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-dag-ggdag-frontdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-both-dags-frontdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: More complex DAG showing that unobserved health behaviors (<span class="math inline">U</span>) confound the relationship between mosquito net use (<span class="math inline">X</span>) and health status (<span class="math inline">Y</span>), which only occurs through the number of mosquitos near a bed (<span class="math inline">M</span>)
</figcaption>
</figure>
</div>
<section id="simulated-data-and-naive-estimate-1" class="level3">
<h3 class="anchored" data-anchor-id="simulated-data-and-naive-estimate-1">Simulated data and naive estimate</h3>
<p>As before, we’ll simulate some data for this new DAG:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">915623</span>, {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  net_data_fd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">u =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> u)),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">m =</span> <span class="dv">10</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">70</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> m <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> u <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Throw away u so we can't use it</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x, y, m)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If we just look at the relationship of <span class="math inline">X</span> on <span class="math inline">Y</span> without adjusting for <span class="math inline">U</span>, we will not get the correct effect for <span class="math inline">X</span> because of confounding. The coefficient on <code>x</code> here is bigger than the true effect of 10 because it conflates the causal effect of nets with health behaviors.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model_naive_fd <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> net_data_fd)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_naive_fd, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       48.04 | 0.25 | [47.56, 48.53] | 194.11 | &lt; .001
x           |       14.00 | 0.40 | [13.22, 14.79] |  35.01 | &lt; .001</code></pre>
</div>
</div>
</section>
<section id="how-do-we-isolate-what-were-looking-for-1" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-isolate-what-were-looking-for-1">How do we isolate what we’re looking for?</h3>
<p>Even though we used a column named <code>u</code> in the simulated dataset, we got rid of it. We have no observable confounders, which means that we can’t use backdoor adjustment.</p>
<p>We can, however, use front-door adjustment! The <a href="./do-calculus.html#eq-frontdoor">front-door adjustment formula</a> tells us what we need to do to estimate <span class="math inline">P(y \mid \operatorname{do}(x))</span>:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_m P(m \mid x) \sum_{x'} P(y \mid x', m) \times P(x')
</span></p>
<ol type="1">
<li><span class="math inline">P(m \mid x)</span>: Estimate how <span class="math inline">X</span> affects <span class="math inline">M</span>. This is unconfounded because <span class="math inline">U</span> doesn’t directly affect <span class="math inline">M</span>.</li>
<li><span class="math inline">\sum_{x'} P(y \mid x', m) \times P(x')</span>: Estimate how <span class="math inline">M</span> affects <span class="math inline">Y</span>, adjusting for <span class="math inline">X</span> to block the backdoor path through <span class="math inline">U</span>.</li>
</ol>
<p>By chaining these two unconfounded estimates together, we can find the full causal effect of <span class="math inline">X</span> on <span class="math inline">Y</span> despite never observing <span class="math inline">U</span>.</p>
</section>
<section id="how-to-actually-do-front-door-adjustment" class="level3">
<h3 class="anchored" data-anchor-id="how-to-actually-do-front-door-adjustment">How to actually do front-door adjustment</h3>
<section id="effect-of-x-on-m" class="level4">
<h4 class="anchored" data-anchor-id="effect-of-x-on-m">Effect of <span class="math inline">X</span> on <span class="math inline">M</span></h4>
<p>First we need to find <span class="math inline">P(m \mid x)</span>, or the effect of <span class="math inline">X</span> on <span class="math inline">M</span>. There’s no confounding on this path—<span class="math inline">U</span> doesn’t control mosquito access to the bed—so we can use a simple regression model:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model_fd_xm <span class="ot">&lt;-</span> <span class="fu">lm</span>(m <span class="sc">~</span> x, <span class="at">data =</span> net_data_fd)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_fd_xm, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(998) |      p
-------------------------------------------------------------------
(Intercept) |       10.00 | 0.08 | [ 9.85, 10.16] | 123.14 | &lt; .001
x           |       -5.07 | 0.13 | [-5.32, -4.81] | -38.58 | &lt; .001</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficient for x:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>coef_xm <span class="ot">&lt;-</span> model_fd_xm <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>(<span class="at">keep =</span> <span class="st">"x"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Coefficient)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>coef_xm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5.065073</code></pre>
</div>
</div>
<p>It looks like using a mosquito net reduces the number of mosquitos near the bed by −5.1 on average. Nets work!</p>
</section>
<section id="effect-of-m-on-y-adjusting-for-x" class="level4">
<h4 class="anchored" data-anchor-id="effect-of-m-on-y-adjusting-for-x">Effect of <span class="math inline">M</span> on <span class="math inline">Y</span>, adjusting for <span class="math inline">X</span></h4>
<p>Next we need to find <span class="math inline">\sum_{x'} P(y \mid x', m) \times P(x')</span>, or the effect of <span class="math inline">M</span> on <span class="math inline">Y</span>, adjusting for <span class="math inline">X</span>.</p>
<p>The path <span class="math inline">M \leftarrow X \leftarrow U \rightarrow Y</span> is a backdoor from <span class="math inline">M</span> to <span class="math inline">Y</span>, but we can block it by adjusting for <span class="math inline">X</span>. We’ll just use regression adjustment here (but we could theoretically use any other method, like IPW, matching, G-computation, etc.)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model_fd_my <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> m <span class="sc">+</span> x, <span class="at">data =</span> net_data_fd)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_fd_my, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(997) |      p
-------------------------------------------------------------------
(Intercept) |       68.02 | 0.75 | [66.54, 69.50] |  90.38 | &lt; .001
m           |       -2.00 | 0.07 | [-2.14, -1.85] | -27.40 | &lt; .001
x           |        3.89 | 0.48 | [ 2.95,  4.82] |   8.15 | &lt; .001</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficient for m:</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>coef_my <span class="ot">&lt;-</span> model_fd_my <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>(<span class="at">keep =</span> <span class="st">"m"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Coefficient)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>coef_my</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.996825</code></pre>
</div>
</div>
<p>From this, it looks like increasing the number of mosquitos near the bed by one causes a −2.0 point decrease in health status, on average. Mosquitos are bad!</p>
</section>
<section id="combined-effect" class="level4">
<h4 class="anchored" data-anchor-id="combined-effect">Combined effect</h4>
<p>To find the total causal effect of <span class="math inline">X</span> on <span class="math inline">Y</span>, we multiply the two effects together:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>coef_xm <span class="sc">*</span> coef_my</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.11407</code></pre>
</div>
</div>
<p>Perfect! The effect of nets on health status is the same as what we built into the data, but we estimated it without touching <span class="math inline">U</span>. This works because <span class="math inline">M</span> fully transmits the causal effect of <span class="math inline">X</span> and there is no unobserved confounding of the <span class="math inline">M \rightarrow Y</span> relationship except through <span class="math inline">X</span>, letting us decompose the problem into two identifiable pieces.</p>
<p>This multiplication works because the relationships are linear. In more complex situations like non-linear models or models with interaction terms, we would need to apply the full front‑door formula by averaging predictions, similar to G‑computation.</p>
</section>
</section>
<section id="hic-sunt-dracones" class="level3">
<h3 class="anchored" data-anchor-id="hic-sunt-dracones">Hic sunt dracones</h3>
<p>Situations like this are <em>exceptionally</em> rare in practice:</p>
<ul>
<li>The mediator must be <strong>completely unaffected by the unobserved confounder</strong> <span class="math inline">U</span> (i.e., no arrow from <span class="math inline">U \rightarrow M</span>). This is an incredibly strong assumption. In this situation, it means that there cannot be any way that an unobserved confounder could possibly influence the number of mosquitos in the immediate vicinity of someone’s bed—the only possible reason for mosquitos near the bed is the presence or absence of a net. That’s… implausible.</li>
<li>The mediator must also <strong>fully mediate</strong> the effect of <span class="math inline">X</span> on <span class="math inline">Y</span>; there can be no direct path from <span class="math inline">X \rightarrow Y</span>. Here that means that mosquito nets can only influence health status because they reduce the number of mosquitos near you while sleeping at night. This is a little more plausible—most people tend to only use nets at night while they sleep.</li>
</ul>
<p>If these assumptions hold, front‑door adjustment is a powerful tool; if not, the estimate will be biased.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I created this example on a whim back in 2019 when I taught my first causal inference class, and it’s proven really useful. I use it all my causal inference classes, in several blog posts, and it’s even used as an example throughout <a href="https://www.r-causal.org/chapters/02-whole-game">Chapter 2</a> of <em>Causal Inference in R</em> <span class="citation" data-cites="todo">[@todo]</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Like marginal structural models and structural nested mean models <span class="citation" data-cites="todo1">[@todo1]</span> or doubly robust augmented inverse probability weighting <span class="citation" data-cites="todo2">[@todo2]</span>. You can get really fancy with these techniques.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dags\.andrewheiss\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>